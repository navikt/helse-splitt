sudo: required

language: java

jdk:
- openjdk10

services:
- docker

script:
- make bump-version
- make

after_success:
- echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
- git config user.name navikt-ci
- git config user.email 32665735+navikt-ci@users.noreply.github.com
- "./travis/deploy.sh"

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"

before_install:
- openssl aes-256-cbc -K $encrypted_7f8420691ff5_key -iv $encrypted_7f8420691ff5_iv
  -in travis/my-private.key.enc -out travis/private.pem -d
- git clone https://github.com/navikt/github-apps-support.git
- export PATH=`pwd`/github-apps-support/bin:$PATH
- export INSTALLATION_TOKEN=$(generate-installation-token.sh `generate-jwt.sh ./travis/private.pem $GITHUB_APP_ID`)

env:
  global:
    secure: YituTIcu8HcW4yy53imHBUi4jNQj+xKGA/Z7BQjV0f84sMGgNm164aKawJKZV3lcA91ZQ6ORWbMuatkldBDCWdY07Hm8Ijioj6Es2KDsLFGLLWFWTpuPla7SPWaxebsPDLGiIv23QuEncpUf2Z1vietAMqo+f/9pEcpZu2bBzMn5rl7/LkVJ577fnsEgBmYjNED5V+PRGo7UIG3/3wE0DGk+LeFt7EHD4cc2aRXKXUbnjIS/d2av4EfJvlasbRseQ0H5WvYyjayyI6IK9rEKd9qQpjCvtN1g3GKJ/iKOLs1seUmUcdTm06upJo2DW7CNqNdTnZLdOCOUm8VAiC4oWS+wauHt+GgHbIo+VUc2nW9j4rnBJORM3IjGOVsApn57cO8sR1xZPMSmO73TuN/msvT2kXxfeaDIljZhnrllpHAZncBTWZ9e53/g+S/pkM4rRwdTg8DojCmJZMTId96LBq72MNYFdpGXTdpph1NlGugwLqzRjdrDXVrwTazVK5NDI9Bb9t/0QWdFXTKoNYdYeYK+1gqaykbVwwBghSATttHFe+BgXQLktVmD/pJuielcj1FgPA/+wDSUuLKch+8yYJUplCHpwh6rG+mr2bX4yFt3f+2NlUFvg9k9GD84DP+uOOdCEuVAfucKuHuw87gioMQlSmtdvVUoGW9INu3OIHo=
